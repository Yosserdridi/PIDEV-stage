<div class="container-fluid h-100">
  <div class="row h-100">
    <!-- Sidebar -->
    <div class="col-md-3 border-end bg-light p-3 d-flex flex-column">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Chat History</h4>
        <button class="btn btn-primary btn-sm"
                (click)="createNewConversation()"
                title="New Chat">
          <i class="bi bi-plus-lg"></i>
        </button>
      </div>

      <!-- Conversation List -->
      <div class="list-group flex-grow-1 overflow-auto chat-container">
        <a *ngFor="let conv of conversations"
           href="javascript:void(0)"
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
           [class.active]="selectedConversationId === conv.id"
           (click)="selectConversation(conv.id)">
          {{ conv.title }}
          <button class="btn btn-link text-danger p-0"
                  type="button"
                  (click)="$event.stopPropagation(); requestDelete(conv.id)"
                  title="Delete conversation">
            <i class="bi bi-trash"></i>
          </button>
        </a>
      </div>

    </div>

    <!-- Chat Area -->
    <div class="col-md-9 d-flex flex-column chat-container">
      <div class="flex-grow-1 overflow-auto p-3 message-container">
        <!-- Messages -->
        <div *ngFor="let message of messages">
          <div class="row mb-3" [class.justify-content-end]="isUserMessage(message)">
            <div class="col-10 col-md-8">
              <div class="card" [class.bg-primary]="isUserMessage(message)" [class.text-white]="isUserMessage(message)">
                <div class="card-body p-3">
                  <div class="card-text">{{ message.content }}</div>
                  <small class="d-block text-end mt-2"
                         [class.text-white-50]="isUserMessage(message)"
                         [class.text-muted]="!isUserMessage(message)">
                    {{ message.createdAt | date:'shortTime' }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div #messagesEnd></div>

        <!-- Loading Indicator -->
        <div *ngIf="isLoading" class="text-center my-3">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="border-top p-3 input-area">
        <form (submit)="onSubmit()" class="input-group">
          <input type="text"
                 class="form-control"
                 [(ngModel)]="input"
                 name="input"
                 placeholder="Type your message..."
                 [disabled]="isLoading">
          <button class="btn btn-primary"
                  type="submit"
                  [disabled]="isLoading || !input.trim()">
            <i class="bi bi-send"></i>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" [class.show]="showDeleteModal" [style.display]="showDeleteModal ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="btn-close" (click)="showDeleteModal = false"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this conversation?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="showDeleteModal = false">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
            <span *ngIf="isDeleting" class="spinner-border spinner-border-sm" role="status"></span>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
